<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>InCheck Issues Dashboard</title>

  <!-- Fonts & Libs -->
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&display=swap" rel="stylesheet">
  <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.1/dist/chart.umd.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/papaparse@5.4.1/papaparse.min.js"></script>

  <style>
    :root {
      --bg:#0b1020; --card:#111935; --muted:#7d8ab3; --text:#e8edff;
      --accent:#4f8cff; --danger:#ef4444; --ok:#10b981; --warn:#f59e0b;
      --info:#3b82f6; --purple:#8b5cf6; --neutral:#6b7280; --border:#1e2643;
      --shadow:0 8px 24px rgba(0,0,0,.35);
    }
    :root[data-theme="light"] {
      --bg:#f8f9ff; --card:#ffffff; --muted:#555; --text:#111;
      --accent:#2563eb; --danger:#dc2626; --ok:#059669; --warn:#d97706;
      --info:#1d4ed8; --purple:#7c3aed; --neutral:#374151; --border:#e7eaf6;
      --shadow:0 10px 24px rgba(16,24,40,.08);
    }
    *{box-sizing:border-box}
    body{margin:0;font-family:Inter,system-ui,Segoe UI,sans-serif;background:var(--bg);color:var(--text);}

    /* Topbar */
    header{position:sticky;top:0;z-index:20;background:var(--card);border-bottom:1px solid var(--border);
      display:flex;align-items:center;gap:12px;padding:10px 16px;box-shadow:var(--shadow);}
    .brand{display:flex;align-items:center;gap:10px;font-weight:700}
    .brand .logo{width:28px;height:28px;border-radius:8px;display:grid;place-items:center;
      background:linear-gradient(135deg,var(--accent),#9b8cff);color:#fff;font-weight:800}
    .toolbar{margin-left:auto;display:flex;gap:10px;align-items:center;flex-wrap:wrap}
    .btn,.select,.input{padding:8px 12px;border-radius:10px;border:1px solid var(--border);background:transparent;color:inherit;font:inherit}
    .btn{cursor:pointer;font-weight:600;background:var(--card)}
    .btn.primary{background:var(--accent);border-color:transparent;color:#fff}
    .btn:hover{opacity:.92;transform:translateY(-1px)}

    /* Layout */
    .wrap{display:grid;grid-template-columns:260px 1fr;gap:18px;padding:18px;max-width:1400px;margin:0 auto}
    @media(max-width:980px){.wrap{grid-template-columns:1fr}}

    /* Sidebar */
    .sidebar{background:var(--card);border:1px solid var(--border);border-radius:14px;padding:16px;position:sticky;top:76px;height:fit-content}
    .sidebar h3{margin:0 0 10px;font-size:14px;color:var(--muted);text-transform:uppercase}
    .sidebar label{display:block;margin:8px 0;font-size:13px}

    /* Content */
    .content{display:grid;gap:18px}
    .grid{display:grid;gap:16px}
    .grid.cols-4{grid-template-columns:repeat(4,1fr)}
    @media(max-width:980px){.grid.cols-4{grid-template-columns:repeat(2,1fr)}}
    @media(max-width:600px){.grid.cols-4{grid-template-columns:1fr}}

    .card{background:var(--card);border:1px solid var(--border);border-radius:14px;padding:16px;box-shadow:var(--shadow)}

    /* KPI */
    .kpi{text-align:center;cursor:pointer}
    .kpi .label{font-size:12px;color:var(--muted);text-transform:uppercase}
    .kpi .value{font-size:26px;font-weight:800;margin-top:6px}

    /* Table */
    table{width:100%;border-collapse:separate;border-spacing:0;font-size:14px}
    th,td{padding:10px;border-bottom:1px solid var(--border);text-align:left}
    thead th{position:sticky;top:0;background:var(--card);cursor:pointer}
    tr:hover{background:rgba(255,255,255,.05)}
    .table-wrap{max-height:420px;overflow:auto;border-radius:10px;border:1px solid var(--border)}
    .pill{padding:2px 8px;border-radius:12px;font-size:12px;font-weight:600;display:inline-block}
    .status-Resolved{background:var(--ok);color:#fff}
    .status-Under\ Development{background:var(--info);color:#fff}
    .status-Rejected{background:var(--danger);color:#fff}
    .status-On\ Hold{background:var(--warn);color:#000}
    .status-Not\ Started\ Yet{background:var(--neutral);color:#fff}
    .priority-High{background:#f87171;color:#fff}
    .priority-Medium{background:#fbbf24;color:#000}
    .priority-Low{background:#34d399;color:#000}

    /* Modal */
    .modal{display:none;position:fixed;inset:0;background:rgba(0,0,0,.55);align-items:center;justify-content:center;z-index:100}
    .modal-content{background:var(--card);color:var(--text);border:1px solid var(--border);padding:18px;border-radius:14px;
      max-width:760px;width:92%;max-height:90%;overflow:auto;box-shadow:var(--shadow)}
    .modal .header{display:flex;align-items:center;justify-content:space-between;margin-bottom:8px}

    /* Toast */
    .toast{position:fixed;right:16px;bottom:16px;background:var(--accent);color:#fff;padding:10px 12px;border-radius:10px;z-index:130;display:none}
  </style>
</head>
<body>
  <header>
    <div class="brand"><div class="logo">IC</div><div>InCheck Issues</div></div>
    <div class="toolbar">
      <input id="searchInput" class="input" type="search" placeholder="Searchâ€¦" />
      <select id="themeSelect" class="select"><option value="system">System</option><option value="dark">Dark</option><option value="light">Light</option></select>
      <button id="refreshNow" class="btn">ðŸ”„ Refresh</button>
      <button id="exportBtn" class="btn">â¬‡ Export CSV</button>
      <button id="newTicketBtn" class="btn primary">âž• New Ticket</button>
    </div>
  </header>

  <div class="wrap">
    <aside class="sidebar">
      <h3>Filters</h3>
      <label>Impacted Module<select id="moduleFilter" class="select"></select></label>
      <label>Priority<select id="priorityFilter" class="select"></select></label>
      <label>Status<select id="statusFilter" class="select"></select></label>
    </aside>

    <main class="content">
      <div class="grid cols-4" id="kpis"></div>
      <div class="grid cols-4">
        <div class="card"><h4>By Impacted Module</h4><canvas id="byModule"></canvas></div>
        <div class="card"><h4>By Priority</h4><canvas id="byPriority"></canvas></div>
        <div class="card"><h4>By Status</h4><canvas id="byStatus"></canvas></div>
        <div class="card"><h4>By Type</h4><canvas id="byType"></canvas></div>
      </div>
      <div class="card">
        <strong>Issues <span id="rowCount"></span></strong>
        <div class="table-wrap">
          <table id="issuesTable">
            <thead><tr>
              <th>ID</th><th>Impacted Module</th><th>Title</th>
              <th>Priority</th><th>Status</th><th>Date</th>
              <th>Log</th><th>Link</th>
            </tr></thead>
            <tbody></tbody>
          </table>
        </div>
      </div>
    </main>
  </div>

  <!-- Issue Modal -->
  <div id="issueModal" class="modal"><div class="modal-content"><div class="header"><h2 id="modalTitle">Issue</h2><button id="modalClose">âœ•</button></div><div id="modalBody"></div></div></div>
  <!-- New Ticket Modal -->
  <div id="newTicketModal" class="modal"><div class="modal-content"><div class="header"><h2>Create New Ticket</h2><button id="closeNewTicket">âœ•</button></div>
    <form id="newTicketForm" style="display:grid;gap:10px">
      <input id="newTitle" class="input" placeholder="Title" required>
      <textarea id="newDesc" class="input" placeholder="Description" required></textarea>
      <select id="newModule" class="select" required><option value="">Impacted Module</option><option>Auth</option><option>Payments</option><option>Dashboard</option></select>
      <select id="newPriority" class="select" required><option value="">Priority</option><option>High</option><option>Medium</option><option>Low</option></select>
      <button type="submit" class="btn primary">Submit</button>
    </form></div></div>

  <div id="toast" class="toast"></div>

<script>
document.addEventListener("DOMContentLoaded", () => {
  const SHEET_URL="https://docs.google.com/spreadsheets/d/e/2PACX-1vTRwAjNAQxiPP8uR15t_vx03JkjgEBjgUwp2bpx8rsHx-JJxVDBZyf5ap77rAKrYHfgkVMwLJVm6pGn/pub?output=csv";
  const els={tableBody:document.querySelector('#issuesTable tbody'),rowCount:document.querySelector('#rowCount'),
    moduleFilter:document.querySelector('#moduleFilter'),priorityFilter:document.querySelector('#priorityFilter'),
    statusFilter:document.querySelector('#statusFilter'),exportBtn:document.querySelector('#exportBtn'),
    refresh:document.querySelector('#refreshNow'),search:document.querySelector('#searchInput'),
    modal:document.querySelector('#issueModal'),modalBody:document.querySelector('#modalBody'),
    modalTitle:document.querySelector('#modalTitle'),modalClose:document.querySelector('#modalClose'),
    newBtn:document.querySelector('#newTicketBtn'),newModal:document.querySelector('#newTicketModal'),
    closeNew:document.querySelector('#closeNewTicket'),newForm:document.querySelector('#newTicketForm'),
    newTitle:document.querySelector('#newTitle'),newDesc:document.querySelector('#newDesc'),
    newModule:document.querySelector('#newModule'),newPriority:document.querySelector('#newPriority'),
    toast:document.querySelector('#toast')};
  let rows=[],filtered=[];

  function normalizeRow(raw){const l={};for(const k in raw){if(!k)continue;l[k.toLowerCase().trim()]=String(raw[k]??'').trim();}
    return{id:l['ticket id']||l['id'],module:l['impacted module']||l['module']||'Unspecified',
      title:l['title'],desc:l['description'],file:l['file upload']||l['link'],priority:l['priority'],
      status:l['status']||'Not Started Yet',type:l['category']||l['type'],date:l['timestamp']||l['date'],log:l['log']};}
  function parseCsv(t){return Papa.parse(t,{header:true,skipEmptyLines:true}).data.map(normalizeRow);}
  function pill(txt,cls){return `<span class="pill ${cls}">${txt||'-'}</span>`;}
  const statusBadge=s=>pill(s,`status-${s.replace(/\s/g,'\\ ')}`),priorityBadge=p=>pill(p,`priority-${p}`);
  function renderTable(){els.tableBody.innerHTML=filtered.map(r=>`<tr data-id="${r.id}"><td>${r.id||'-'}</td><td>${r.module}</td><td>${r.title||'-'}</td><td>${priorityBadge(r.priority)}</td><td>${statusBadge(r.status)}</td><td>${r.date||'-'}</td><td>${r.log||'-'}</td><td>${r.file?`<a href="${r.file}" target="_blank">ðŸ”—</a>`:'-'}</td></tr>`).join('');els.rowCount.textContent=`${filtered.length} rows`;}
  function drawCharts(){const gc=(k)=>filtered.reduce((a,r)=>{a[r[k]||'Unspecified']=(a[r[k]||'Unspecified']||0)+1;return a;},{});new Chart(document.querySelector('#byModule'),{type:'bar',data:{labels:Object.keys(gc('module')),datasets:[{data:Object.values(gc('module'))}]}});}
  async function load(){const res=await fetch(SHEET_URL);const text=await res.text();rows=parseCsv(text);filtered=rows;renderTable();drawCharts();}
  function openModal(id){const r=rows.find(x=>x.id===id);if(!r)return;els.modalTitle.textContent=r.title||r.id;els.modalBody.innerHTML=`<p><b>ID:</b> ${r.id}</p><p><b>Impacted Module:</b> ${r.module}</p><p><b>Priority:</b> ${r.priority}</p><p><b>Status:</b> ${r.status}</p><p><b>Date:</b> ${r.date}</p><p><b>Description:</b> ${r.desc}</p><p><b>Log:</b> ${r.log}</p>`;els.modal.style.display='flex';}
  els.tableBody.addEventListener('click',e=>{const tr=e.target.closest('tr');if(tr)openModal(tr.dataset.id);});
  els.modalClose.onclick=()=>els.modal.style.display='none';
  els.exportBtn.onclick=()=>{const csv=Papa.unparse(filtered);const blob=new Blob([csv],{type:'text/csv'});const a=document.createElement('a');a.href=URL.createObjectURL(blob);a.download='issues.csv';a.click();};
  els.newBtn.onclick=()=>els.newModal.style.display='flex';
  els.closeNew.onclick=()=>els.newModal.style.display='none';
  els.newForm.onsubmit=e=>{e.preventDefault();const t=els.newTitle.value;els.toast.textContent=`New ticket created: ${t}`;els.toast.style.display='block';setTimeout(()=>els.toast.style.display='none',3000);els.newModal.style.display='none';els.newForm.reset();};
  load();
});
</script>
</body>
</html>
