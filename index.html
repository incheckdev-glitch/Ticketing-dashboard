<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>InCheck Issues Dashboard</title>

  <!-- Tailwind via CDN -->
  <script src="https://cdn.tailwindcss.com"></script>
  <script>
    tailwind.config = {
      darkMode: 'class',
      theme: {
        extend: {
          fontFamily: { inter: ["Inter", "sans-serif"] },
          colors: {
            accent: "#4f8cff",
            danger: "#ef4444",
            ok: "#10b981",
            warn: "#f59e0b",
            info: "#3b82f6",
            purple: "#8b5cf6",
            neutral: "#6b7280"
          }
        }
      }
    }
  </script>

  <!-- Fonts & Libraries -->
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&display=swap" rel="stylesheet">
  <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.1/dist/chart.umd.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/papaparse@5.4.1/papaparse.min.js"></script>
</head>

<body class="bg-white text-gray-900 dark:bg-gray-950 dark:text-gray-100 font-inter transition-colors duration-300">

  <!-- Header -->
  <header class="sticky top-0 z-50 bg-white/90 dark:bg-gray-900/80 backdrop-blur border-b border-gray-200 dark:border-gray-800 shadow-md">
    <div class="max-w-7xl mx-auto flex flex-wrap items-end gap-4 px-4 py-3">
      <h1 class="font-bold text-xl">InCheck Issues Dashboard</h1>

      <div class="ml-auto flex flex-wrap gap-3 items-end text-sm">

        <!-- Search -->
        <label class="flex flex-col text-xs font-semibold text-gray-600 dark:text-gray-300">
          Search
          <input id="searchInput" type="search" placeholder="Search issues..."
            class="mt-1 rounded-xl px-3 py-2 bg-gray-100 dark:bg-gray-800 border border-gray-300 dark:border-gray-700 focus:ring-2 focus:ring-accent outline-none" />
        </label>

        <!-- Module -->
        <label class="flex flex-col text-xs font-semibold text-gray-600 dark:text-gray-300">
          Module
          <select id="moduleFilter"
            class="mt-1 rounded-xl px-3 py-2 bg-gray-100 dark:bg-gray-800 border border-gray-300 dark:border-gray-700"></select>
        </label>

        <!-- Priority -->
        <label class="flex flex-col text-xs font-semibold text-gray-600 dark:text-gray-300">
          Priority
          <select id="priorityFilter"
            class="mt-1 rounded-xl px-3 py-2 bg-gray-100 dark:bg-gray-800 border border-gray-300 dark:border-gray-700"></select>
        </label>

        <!-- Status -->
        <label class="flex flex-col text-xs font-semibold text-gray-600 dark:text-gray-300">
          Status
          <select id="statusFilter"
            class="mt-1 rounded-xl px-3 py-2 bg-gray-100 dark:bg-gray-800 border border-gray-300 dark:border-gray-700"></select>
        </label>

        <!-- Start Date -->
        <label class="flex flex-col text-xs font-semibold text-gray-600 dark:text-gray-300">
          Start Date
          <input type="date" id="startDateFilter"
            class="mt-1 rounded-xl px-3 py-2 bg-gray-100 dark:bg-gray-800 border border-gray-300 dark:border-gray-700" />
        </label>

        <!-- End Date -->
        <label class="flex flex-col text-xs font-semibold text-gray-600 dark:text-gray-300">
          End Date
          <input type="date" id="endDateFilter"
            class="mt-1 rounded-xl px-3 py-2 bg-gray-100 dark:bg-gray-800 border border-gray-300 dark:border-gray-700" />
        </label>

        <!-- Buttons -->
        <button id="refreshNow"
          class="px-4 py-2 rounded-lg bg-accent hover:bg-blue-500 text-white font-semibold">Refresh</button>
        <button id="resetBtn"
          class="px-4 py-2 rounded-lg bg-gray-200 dark:bg-gray-700 hover:bg-gray-300 dark:hover:bg-gray-600 font-semibold">Reset</button>
        <a href="https://docs.google.com/forms/d/e/1FAIpQLScZBcjXHMzssdXADWcmBiQKurxxR6eHQ_qR7-JdDoUbZg78lw/viewform"
           target="_blank"
           class="px-4 py-2 rounded-lg bg-green-600 hover:bg-green-500 text-white font-semibold">‚ûï New Ticket</a>
        <button id="themeToggle"
          class="px-3 py-2 rounded-lg bg-gray-200 dark:bg-gray-800 hover:bg-gray-300 dark:hover:bg-gray-700">üåô</button>
      </div>
    </div>
  </header>

  <!-- Content -->
  <main class="max-w-7xl mx-auto px-4 py-6 space-y-6">

    <!-- KPI Cards -->
    <div id="kpis" class="grid grid-cols-1 sm:grid-cols-2 md:grid-cols-4 gap-4"></div>

    <!-- Charts -->
    <div class="grid md:grid-cols-2 gap-4">
      <div class="bg-white dark:bg-gray-900 rounded-2xl p-4 shadow"><canvas id="byModule"></canvas></div>
      <div class="bg-white dark:bg-gray-900 rounded-2xl p-4 shadow"><canvas id="byPriority"></canvas></div>
      <div class="bg-white dark:bg-gray-900 rounded-2xl p-4 shadow"><canvas id="byStatus"></canvas></div>
      <div class="bg-white dark:bg-gray-900 rounded-2xl p-4 shadow"><canvas id="byType"></canvas></div>
    </div>

    <!-- Issues Table -->
    <div class="bg-white dark:bg-gray-900 rounded-2xl p-6 shadow space-y-4">
      <div class="flex justify-between items-center">
        <strong class="text-lg">Issues</strong>
        <span id="rowCount" class="text-sm text-gray-500 dark:text-gray-400"></span>
      </div>
      <div class="overflow-auto max-h-[500px] rounded-xl border border-gray-200 dark:border-gray-800">
        <table id="issuesTable" class="w-full text-sm">
          <thead class="sticky top-0 bg-gray-100 dark:bg-gray-800/80 backdrop-blur">
            <tr class="text-left">
              <th class="px-4 py-2">ID</th>
              <th class="px-4 py-2">Module</th>
              <th class="px-4 py-2">Title</th>
              <th class="px-4 py-2">Priority</th>
              <th class="px-4 py-2">Status</th>
              <th class="px-4 py-2">Date</th>
              <th class="px-4 py-2">Log</th>
              <th class="px-4 py-2">Link</th>
            </tr>
          </thead>
          <tbody class="divide-y divide-gray-200 dark:divide-gray-800"></tbody>
        </table>
      </div>
    </div>
  </main>

  <!-- Modal -->
  <div id="issueModal"
       class="fixed inset-0 hidden bg-black/70 backdrop-blur-sm items-center justify-center z-50">
    <div class="bg-white dark:bg-gray-900 rounded-2xl shadow-xl max-w-2xl w-11/12 p-6 relative">
      <button onclick="closeModal()" class="absolute top-3 right-3 text-gray-400 hover:text-black dark:hover:text-white">‚úñ</button>
      <div id="modalBody" class="space-y-2"></div>
    </div>
  </div>

  <!-- Logic -->
  <script>
    // (same JS logic as before, unchanged)
    // ...
    // üåó Theme Toggle
    const themeBtn=document.getElementById('themeToggle');
    if(localStorage.getItem('theme')==="dark"){document.documentElement.classList.add('dark');themeBtn.textContent="‚òÄÔ∏è";}else{document.documentElement.classList.remove('dark');themeBtn.textContent="üåô";}
    themeBtn.addEventListener('click',()=>{const isDark=document.documentElement.classList.contains('dark');if(isDark){document.documentElement.classList.remove('dark');localStorage.setItem('theme','light');themeBtn.textContent="üåô";}else{document.documentElement.classList.add('dark');localStorage.setItem('theme','dark');themeBtn.textContent="‚òÄÔ∏è";}});
  </script>
</body>
</html>
