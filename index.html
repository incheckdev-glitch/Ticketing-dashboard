<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>InCheck Issues Dashboard</title>

  <!-- Libs -->
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&display=swap" rel="stylesheet">
  <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.1/dist/chart.umd.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/papaparse@5.4.1/papaparse.min.js"></script>

  <style>
    /* ... keep your CSS exactly as before ... */
  </style>
</head>
<body>
  <header>
    <div class="brand">
      <div class="logo">IC</div>
      <div>InCheck Issues</div>
    </div>

    <button id="drawerBtn" class="btn drawer-toggle"><span class="icon">ðŸ§°</span> Filters</button>

    <div class="toolbar">
      <input id="searchInput" class="input" type="search" placeholder="Search ID, title, description, logâ€¦" />
      <select id="themeSelect" class="select">
        <option value="system">System</option>
        <option value="dark">Dark</option>
        <option value="light">Light</option>
      </select>
      <button id="refreshNow" class="btn"><span class="icon">ðŸ”„</span> Refresh</button>
      <button id="exportBtn" class="btn"><span class="icon">â¬‡</span> Export CSV</button>
      <a href="https://docs.google.com/forms/d/e/1FAIpQLScZBcjXHMzssdXADWcmBiQKurxxR6eHQ_qR7-JdDoUbZg78lw/viewform" target="_blank">
        <button id="newTicketBtn" class="btn primary"><span class="icon">âž•</span> New Ticket</button>
      </a>
    </div>
  </header>

  <div class="wrap">
    <!-- Sidebar -->
    <aside class="sidebar" id="sidebar">
      <h3>Filters</h3>
      <div class="filter-group">
        <div class="filter-row">
          <label class="muted">Impacted Module</label>
          <select id="moduleFilter" class="select"></select>
        </div>
        <div class="filter-row">
          <label class="muted">Priority</label>
          <select id="priorityFilter" class="select"></select>
        </div>
        <div class="filter-row">
          <label class="muted">Status</label>
          <select id="statusFilter" class="select"></select>
        </div>
      </div>
      <!-- ... rest sidebar unchanged ... -->
    </aside>

    <!-- Main content -->
    <main class="content">
      <div class="grid cols-4" id="kpis"></div>

      <div class="charts">
        <div class="card"><h4 style="margin:0 0 8px 0">By Impacted Module</h4><canvas id="byModule" height="140"></canvas></div>
        <div class="card"><h4 style="margin:0 0 8px 0">By Priority</h4><canvas id="byPriority" height="140"></canvas></div>
        <div class="card"><h4 style="margin:0 0 8px 0">By Status</h4><canvas id="byStatus" height="140"></canvas></div>
        <div class="card"><h4 style="margin:0 0 8px 0">By Type</h4><canvas id="byType" height="140"></canvas></div>
      </div>

      <div class="card">
        <div style="display:flex;justify-content:space-between;align-items:center;margin-bottom:8px">
          <strong>Issues</strong>
          <span id="rowCount" class="muted"></span>
        </div>

        <div class="table-wrap">
          <table id="issuesTable">
            <thead><tr>
              <th data-key="id" class="sortable">ID</th>
              <th data-key="module" class="sortable">Impacted Module</th>
              <th data-key="title" class="sortable">Title</th>
              <th data-key="priority" class="sortable">Priority</th>
              <th data-key="status" class="sortable">Status</th>
              <th data-key="date" class="sortable">Date</th>
              <th data-key="log" class="sortable">Log</th>
              <th>Link</th>
            </tr></thead>
            <tbody></tbody>
          </table>
        </div>
        <!-- ... pagination stays the same ... -->
      </div>
    </main>
  </div>

  <!-- Modal -->
  <div id="issueModal" class="modal">
    <div class="modal-content">
      <div class="header">
        <h2 id="modalTitle">Issue</h2>
        <div class="actions">
          <button id="copyId" class="btn sm"><span class="icon">ðŸ†”</span> Copy ID</button>
          <button id="copyLink" class="btn sm"><span class="icon">ðŸ”—</span> Copy Link</button>
          <button class="modal-close" id="modalClose">âœ•</button>
        </div>
      </div>
      <div id="modalBody"></div>
    </div>
  </div>

  <div class="spinner" id="spinner"><div class="ring"></div></div>
  <div class="toast" id="toast"></div>

<script>
document.addEventListener("DOMContentLoaded", () => {
  const SHEET_URL = "https://docs.google.com/spreadsheets/d/e/2PACX-1vTRwAjNAQxiPP8uR15t_vx03JkjgEBjgUwp2bpx8rsHx-JJxVDBZyf5ap77rAKrYHfgkVMwLJVm6pGn/pub?output=csv";

  // ... keep all your JS as before ...

  // Modal body (change "Module" -> "Impacted Module")
  function openModal(id){
    const r = rows.find(x=>x.id===id);
    if(!r) return;
    selectedIssue = r;
    els.modalTitle.textContent = r.title || r.id || 'Issue';
    els.modalBody.innerHTML = `
      <p><b>ID:</b> ${r.id || '-'}</p>
      <p><b>Impacted Module:</b> ${r.module || '-'}</p>
      <p><b>Priority:</b> ${r.priority || '-'}</p>
      <p><b>Status:</b> ${r.status || '-'}</p>
      <p><b>Date:</b> ${r.date || '-'}</p>
      <p><b>Description:</b><br>${r.desc || '-'}</p>
      <p><b>Log:</b><br>${r.log || '-'}</p>
      ${r.file ? `<p><b>Attachment:</b> <a href="${r.file}" target="_blank">${r.file}</a></p>` : ''}
    `;
    els.modal.style.display='flex';
  }

  // Hook up export
  els.exportBtn.addEventListener('click', exportCsv);

  // ... rest of your listeners and init remain the same ...
});
</script>
</body>
</html>
